### **引言**

本手册将指导您从零开始，一步步地完成“猿眼电影订票系统”的现代化重构。我们将分别构建后端服务和前端应用，最终将它们整合为一个功能完整的全栈项目。

#### **后端 (`Flask-Server/`)**

```
Flask-Server/
├── app/                      # Flask 应用核心代码目录
│   ├── api/                  # 存放所有 API 接口的模块
│   │   ├── __init__.py       # 初始化 API 蓝图并注册所有接口
│   │   ├── user.py           # 用户注册接口
│   │   ├── session.py        # 用户登录/退出/状态检查接口
│   │   └── ... (movie, screen, order, comment, favorite, coupon 等接口)
│   ├── __init__.py           # 应用工厂，负责创建和配置 Flask 应用实例
│   ├── models.py             # 定义所有数据库表的 SQLAlchemy ORM 模型
│   └── admin.py              # 定义 Flask-Admin 的后台管理视图
├── migrations/               # 由 Flask-Migrate 自动生成的数据库迁移脚本目录
├── .env.docker               # Docker 环境专用的配置文件 (数据库地址, 密钥等)
├── config.py                 # 从 .env 文件加载配置的 Python 文件
├── Dockerfile                # 定义如何构建后端服务的 Docker 镜像
├── docker-compose.yml        # 定义和编排后端、数据库、缓存等多个 Docker 服务
├── gunicornConf.py           # Gunicorn WSGI 服务器的配置文件
├── requirements.txt          # 项目的所有 Python 依赖包列表
├── scraper.py                # 独立的豆瓣电影爬虫脚本
├── seed_data.json            # 由爬虫生成的、用于填充数据库的电影数据
└── server.py                 # 项目的顶层入口文件，并注册了自定义的 seed 命令
```

#### **前端 (`MonkeyEye-FE/`)**

```
MonkeyEye-FE/
├── public/                   # 存放不会被构建处理的静态资源
├── src/                      # 前端应用核心代码目录
│   ├── assets/               # 存放全局 CSS 文件 (main.css) 和图片等
│   ├── router/               # 路由配置目录
│   │   └── index.ts          # 定义所有页面路由和全局路由守卫
│   ├── services/             # API 服务目录
│   │   └── api.ts            # 封装 axios 实例，作为统一的后端请求出口
│   ├── stores/               # Pinia 状态管理目录
│   │   └── auth.ts           # 管理用户登录状态、信息，并封装登录/注册等 action
│   ├── views/                # 存放页面级组件的目录
│   │   ├── auth/             # 登录(SigninView.vue)和注册(SignupView.vue)页面
│   │   ├── movie/            # 电影列表(MoviesView.vue)和详情(MovieDetailView.vue)页面
│   │   ├── order/            # 选场次、选座、确认订单页面
│   │   ├── profile/          # 个人中心主页、我的订单、优惠券、收藏页面
│   │   └── MainView.vue      # 登录后承载大部分页面的主布局组件
│   ├── App.vue               # Vue 应用的根组件，只包含 <RouterView />
│   └── main.ts               # 应用的主入口文件，负责初始化 Vue, Pinia, Router
├── index.html                # 应用的 HTML 主入口
├── package.json              # 项目的 npm 依赖和脚本配置
├── tailwind.config.js        # Tailwind CSS 的配置文件
├── postcss.config.js         # PostCSS 的配置文件
└── vite.config.ts            # Vite 构建工具的配置文件
```

### **阶段〇：环境准备**

在开始编码前，请确保您的电脑上已安装并配置好以下核心工具：

1. **Docker Desktop**: 用于创建和管理我们后端服务的容器化环境。这是保证后端环境一致性的关键。
    
2. **Node.js 与 nvm**: 我们使用 nvm (Node Version Manager) 来安装和管理 Node.js 环境，以获得最纯净、最稳定的前端开发环境。
    
3. **Conda**: 用于创建独立的 Python 虚拟环境，主要用来运行我们的辅助脚本（如爬虫）。
    
4. **代码编辑器**: 例如 VS Code。
    
5. **终端/命令行工具**。
    

### **阶段一：后端 (Flask Server) 的搭建**

我们将首先构建完整的后端服务，确保所有 API 接口都能正常工作。

#### **第1步：项目初始化与文件结构**

1. 创建一个名为 `Flask-Server` 的主目录。
    
2. 在 `Flask-Server` 内部，创建 `app` 文件夹，并在 `app` 文件夹内创建 `api` 子文件夹。
    
3. 创建以下所有必需的空文件和配置文件。最终，您的初始目录结构应如下：
    
    ```
    Flask-Server/
    ├── app/
    │   ├── api/
    │   │   └── __init__.py
    │   ├── __init__.py
    │   ├── models.py
    │   └── admin.py
    ├── .env.docker
    ├── config.py
    ├── Dockerfile
    ├── docker-compose.yml
    ├── gunicornConf.py
    ├── requirements.txt
    └── server.py
    ```
    

#### **第2步：编写核心配置文件**

1. **`requirements.txt` (依赖清单)**: 定义所有 Python 依赖。
    
    ```
    # Flask and extensions
    Flask>=2.0
    Flask-SQLAlchemy>=3.0
    Flask-Login>=0.6
    Flask-Admin>=1.6
    Flask-WTF>=1.0
    werkzeug>=2.0
    python-dotenv>=1.0.0
    Flask-CORS>=4.0.0
    wtforms-sqlalchemy
    
    # API Framework
    flask-restx
    
    # Database
    SQLAlchemy>=1.4
    mysqlclient
    PyMySQL
    alembic
    Flask-Migrate
    cryptography
    
    # WSGI Server and Concurrency
    gunicorn>=2.0
    gevent
    
    # Web Scraping Libraries
    requests
    beautifulsoup4
    lxml
    
    # Utilities
    redis>=4.0
    Pillow>=9.0
    ```
    
2. **`config.py` (配置加载)**: 从环境变量加载配置。
    
    ```
    import os
    
    class Config:
        SECRET_KEY = os.environ.get('SECRET_KEY') or 'a-default-secret-key'
        SQLALCHEMY_DATABASE_URI = os.environ.get('SQLALCHEMY_DATABASE_URI')
        SQLALCHEMY_TRACK_MODIFICATIONS = False
        SQLALCHEMY_RECORD_QUERIES = True
        # ... (包含所有其他配置项)
    ```
    
3. **`.env.docker` (Docker 环境配置)**: 为 Docker 环境提供具体的配置值。
    
    ```
    SECRET_KEY='a_local_dev_secret_key'
    SQLALCHEMY_DATABASE_URI='mysql+pymysql://monkeyeye_user:monkeyeye_password@db:3306/monkeyeye_db'
    REDIS_HOST='cache'
    # ... (包含所有其他配置项)
    ```
    

#### **第3步：设置 Docker 环境**

1. **`Dockerfile` (镜像构建指南)**: 定义如何构建后端服务的镜像。
    
    ```
    FROM python:3.9-slim
    WORKDIR /app
    RUN sed -i 's/deb.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list.d/debian.sources && \
        apt-get update && apt-get install -y --no-install-recommends \
        build-essential default-libmysqlclient-dev pkg-config && \
        rm -rf /var/lib/apt/lists/*
    COPY requirements.txt requirements.txt
    RUN pip install --no-cache-dir -i https://mirrors.aliyun.com/pypi/simple/ -r requirements.txt
    COPY . .
    EXPOSE 5000
    CMD ["gunicorn", "--config", "gunicornConf.py", "server:py"]
    ```
    
2. **`docker-compose.yml` (服务编排)**: 定义并连接后端、数据库和缓存服务。
    
    ```
    services:
      backend:
        build: .
        ports: ["5000:5000"]
        volumes: [".:/app"]
        env_file: [".env.docker"]
        depends_on:
          db: { condition: service_healthy }
      db:
        image: mysql:8.0
        environment: # ... (数据库环境变量)
        volumes: [db_data:/var/lib/mysql]
        ports: ["3307:3306"]
        healthcheck: # ... (健康检查配置)
      cache:
        image: redis:7
    volumes:
      db_data:
    ```
    

#### **第4步：编写应用核心逻辑**

1. **`app/models.py` (数据模型)**: 定义所有数据库表的 SQLAlchemy ORM 模型。
    
2. **`app/admin.py` (后台视图)**: 定义所有 Flask-Admin 的管理视图类。
    
3. **`app/api/` (API 接口)**: 逐一创建 `user.py`, `session.py`, `movie.py` 等所有 API 接口文件。
    
4. **`app/__init__.py` (应用工厂)**: 编写 `create_app` 函数，初始化所有插件并注册蓝图和 Admin 视图。
    
5. **`server.py` (入口与脚本)**: 编写顶层入口文件，并添加 `seed` 和 `seed-screens` 自定义命令。
    

#### **第5步：启动与初始化**

1. **启动服务**: `docker-compose up --build -d`
    
2. **初始化数据库**: `docker-compose exec backend flask db init`, `migrate`, `upgrade`
    
3. **填充数据**: `docker-compose exec backend flask seed`
    

至此，一个功能完整的后端服务已经搭建并运行起来了。

### **阶段二：前端 (Vue App) 的搭建**

在后端准备就绪后，我们开始构建与之交互的前端应用。

#### **第1步：项目初始化**

1. 在工作目录下，运行 `npm create vue@latest` 创建一个名为 `MonkeyEye-FE` 的新项目，并根据向导选择集成 `TypeScript`, `Vue Router`, `Pinia`, `ESLint` 和 `Prettier`。
    
2. 进入 `MonkeyEye-FE` 目录，运行 `npm install`。
    

#### **第2步：集成与配置 Tailwind CSS**

1. 运行 `npm install -D tailwindcss@^3.0.0 postcss@^8.0.0 autoprefixer@^10.0.0` 安装稳定版的 Tailwind v3。
    
2. 运行 `npx tailwindcss init -p` 创建配置文件。
    
3. 配置 `tailwind.config.js` 和 `postcss.config.js`。
    
4. 修改 `src/assets/main.css`，只保留 Tailwind 的三条指令。
    
5. 在 `src/main.ts` 的第一行导入 `main.css`。
    
6. 修改 `vite.config.ts`，添加 `@` 作为 `src` 目录的路径别名。
    

#### **第3步：构建应用结构与页面**

1. **清理**: 删除 `src/components` 和 `src/views` 目录下的所有示例文件。
    
2. **创建目录**: 创建 `src/services`, `src/views/auth`, `src/views/movie`, `src/views/order`, `src/views/profile` 等目录。
    
3. **编写核心文件**:
    
    - **`src/services/api.ts`**: 创建并配置 `axios` 实例。
        
    - **`src/stores/auth.ts`**: 创建 Pinia store，封装登录、注册、创建订单等 actions。
        
    - **`src/router/index.ts`**: 定义所有页面的路由规则和全局路由守卫。
        
    - **`src/App.vue`**: 清理内容，只保留 `<RouterView />`。
        
4. **逐一开发页面组件**: 按照我们之前的流程，依次创建 `SigninView.vue`, `MainView.vue`, `MoviesView.vue`, `MovieDetailView.vue` 等所有页面组件，并编写其模板和逻辑。
    

#### **第4步：启动与联调**

1. **启动服务**: `npm run dev`
    
2. **联调**: 在浏览器中访问前端地址（如 `http://localhost:5173`），与后端服务进行交互，测试所有功能。
    

### **总结**

这个从零开始的流程遵循了“后端先行，前端消费”的开发模式。每一步都以前一步的成果为基础，逻辑清晰，层层递进。通过这个流程，您可以独立地、完整地重现我们整个项目的构建过程。