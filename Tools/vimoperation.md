# vim

## 基本移动

- `hjkl`:上下左右
- `gg`:到第一行
- `G`:到最后一行
- `ctrl+u`:往上翻半页
- `ctrl+d`:往下翻半页
- `{lineno}gg}`:跳到第`lineno`行
- `zz/zt/zb`:光标行设置为屏幕居中/屏幕第一行/屏幕最后一行

## Insert model

- `i`:代表'insert',当前光标之前开始输入
- `a`:代表'append',当前光标之后开始输入
- `o`:下方插入新的一行,然后开始输入
- `s`:删除当前光标的字符,然后开始输入
- `I`:在本行的开头开始输入
- `A`:在本行的末尾开始输入
- `O`:上方插入新的一行,然后开始输入
- `S`:删除当前行,然后开始输入
- 
## Visual model

- visual model下按`x/y`可以进行剪切/复制；回到Normal model下按`p`进行粘贴
- Normal model下按`V`进入visual model,一次选中一整行,在需要选中多行的时候很方便

## 移动与编辑

### 基于单词的移动

- `w`:代表'word',跳转到下一处单词的开头
- `b`:代表'back',跳转到上一处单词的开头
- `e`:代表'end',跳转到下一处单词的结尾
- `ge`:`e`的反向版本,跳转到上一处单词的结尾
- `wbe`的大写版本`WBE`对应的单词是连续的非空字符
- ![WEB&web](vimoperation/image.png)


### 基于搜索的移动

#### 行内搜索

- `f{char}/t{char}`:跳转到本行下一个`char`字符出现处/出现前
- `;/,`:快速向后/向前重复`ft`查找
- `F{char}/T{char}`:往前搜索而非往后

#### 文件中搜索

- `/{pattern}`:跳转到本文件中下一个`pattern`出现的地方
- `?{pattern}`:跳转到本文件中上一个`pattern`出现的地方
- `pattern`可以是正则表达式
- `*`:等价于`/{pattern}`,`pattern`是当前光标下的单词
- `nN`:快速重复`/`查找

### 基于标记的移动

- `m{mark}`:把当前位置标记为`mark`
- ``{mark}`:跳转到名为`mark`的标记位置
- `mark`是`a-z`的字符
- 内置标记：
    - ``:上次跳转前的位置
    - `. : 上次修改的位置
    - `^: 上次插入的位置

### 常用的跳转

- `^`:跳转到本行的开头
- `$`:跳转到本行的结尾
- `%`:跳转到匹配的配对符（比如括号）处

## Operator+Motion=Action

- `{operator}{motion}`:一次编辑动作
- 常见操作符：
    - `c`:代表'changer',修改,删除内容,并进入插入模式
    - `d`:代表'delete',删除
    - `y`:代表'yank',复制
    - `v`:代表'visual',选中文本,进入可视模式
    - 大部分操作符连续按两次(`cc/dd/yy`)代表将其作用在这一行上
- 例子：
    - `dgg`:删除到第一行
    - `ye`:复制到单词结尾
    - `d$`:删除到行尾
    - `dt;`:删除到分号为止的内容
    - `dd`:删除这一行

## 重复操作：`.`命令

- `.`:重复上一次修改
- `u`:撤销上一次修改
- `ctrl+ r`:重做上一次修改
- `.`命令适合需要多次重复莫一个修改动作的场景

## 批量操作：Count+Action

- `{count}{action}`:重复`count`次`action`动作
- 动作可以是移动动作或者是编辑动作
    - `4j`:向下移动四行
    - `3dw`:删除两个单词
    - `2yy`:复制两行
    - `4p`:粘贴四次
- 数字加动作是一种重要的批量操作方式,命令直观,语义明确
    - `.`命令可以直观的看到每次的变化,在合适的时候停止
    - 数字加动作则需要预先知道动作的次数
- 技巧：使用相对行号确定移动范围
    - `set relativenumber`:开启
    - `set norelativenumber`:关闭

## 文本对象操作：Operator+textobjects

- `textobject`:语义化的文本片段
- 格式:`i/a`+对象
- 常见对象：
    - `w/W`,`s`,`p`:单词、句子、段落
    - `(`/`)`,`[`/`]`,`{`/`}`,`<`/`>`,`'`/`"`:配对符定义的对象
    - `i`代表'inner',`a`代表'a',额外包括周围的空格或配对符
        - ![inner&a](vimoperation/image-1.png)
- 文本对象为文本赋予了结构化的含义,允许我们以一个予以对象为操作单元:`[count]{operator}{textobject}`
- 示例
    - `diw`:删除一个单词
    - `ci(`:删除小括号内部
    - `yi(`:复制大括号内部
    - 配合`.`或者`count`可以简单的完成多次对特定语义对象的操作

## 操作符与命令补充

- `gu/gU/g~`:操作符,转小写/大写/翻转大小写
- `J`:'join',连接两行
- `ctrl+a/ctrl+x`:增加数字/减少数字
- `g<ctrl-A>`:创建递增序列
- `<`/`>`:左右缩进

## 寄存器与宏

### 寄存器 Register

- 一个字符对应一个寄存器(如`a-z`,`0-9`)
- 特别的寄存器：
    - `"`:默认寄存器,平时复制、删除的内容都放在里面
    - `%`:当前文件名
    - `.`:上一次插入的内容
    - `:`:上一次执行的命令
- 通过`reg{register}`查看对应寄存器中的内容
- 指定寄存器
    - 在复制/删除/粘贴等操作前加上`"{register}`就可以指定本次操作所用的寄存器,只要设计寄存器操作都可以这样指定
    - `"ayy`:将这一行复制到`a`寄存器中
    - `"bdiw`:将单词删除,保存到`b`寄存器中
    - `"cp`:将`c`寄存器中的内容粘贴出来
- 常见用途：将想要持久保存的文本放到特定的寄存器中,随时进行粘贴,避免被覆盖
- 寄存器字符大写:添加(append)而非覆盖

### 宏 Macro

- 录制一系列键盘操作,并允许我们重放这些操作
- 操作序列存储在指定的寄存器中
    - `q{register}`:开始录制宏,存放在寄存器`register`中
    - 录制过程中按`q`退出录制
    - `@{register}`:重放寄存器`register`中的操作
    - `@@`:重放上一次宏操作
- 常见用法：`q{register}`录制一段操作,`@{register}`重放,然后一直`@@`重放
- **注意**：`.`命令对宏不起效,`.`命令只记录上一次修改,然而宏可能包含多次修改

## 命令模式：以行为单位

### Ex命令格式

- `:[range]{excommand}[args]`
    - `range`:作用的范围,不给的话默认是本行
    - `excommand`:特殊的命令,适用于Command模式
        - `:[range] delete [x]`: 删除`rnage`中的行(到寄存器`x`),`delete`可以简写为`d`
        - `:[range] yank [x]`:复制`range`中的行(到寄存器`x`),`yank`可以简写为`y`
        - `:[range] print`:将`range`中的行打印出来,`print`可以简写为`p`
    - `args`:后续的参数,是命令而定

- `address`可以是：
    - `{lineno}`:行号,如`3`代表第三行(0代表第一行上面的虚拟行)
    - `$`:最后一行
    - `.`:光标所在行
    - `/{pattern}/`:下一个`pattern`所在的行
    - `address`可以做加减法，`.+3`代表光标往下第三行,`$-3`代表倒数第四行

- `range`和`address`:指定范围
    - `range`由一个或是两个`address`构成，即`{address}`或`{address},{address}`

- `address`组合成`range`
    - `1,3`:文件的一到三行
    - `.,.+4`:当前到当前往下四行(共五行)
    - `$-3,$`:文件的最后四行
    - `%`:特殊的range，代表当前文件的所有行
    - `<`/`>`:可视模式中选中范围的开头和结尾(可是模式下直接按`:`可以直接设置)

- 例子
    - `1,3 delete`:删除一到三行
    - `.,.+4,yank`:复制当前到当前往下四行
    - `$-3,#`:打印文件最后四行


### 行的复制、粘贴和移动

- `:[range] copy {address}`:把`range`中的行复制到`address`后面
- `:[range] move {address}`:把`range`中的行移动到`address`后面
- `:[address] put [x]`:把寄存器`x`的内容粘贴到`address`后面
- 0作为虚拟的address,可以用来将内容插入到第一行

### Ex命令

- `:[range] delete [x]`:删除
- `:[range] yank [x]`:复制
- `:[range] print`:打印
- `:[range] copy [x]`：拷贝
- `:[range] move [x]`:移动
- `:[address] put [x]`:粘贴

### excommand & normal

- 命令模式下的编辑操作以**行**为单位
- 命令模式下的编辑操作无需移动光标

## 批量操作

### normal命令

- 格式:`:[range] normal {commands}`
- 含义：**对`range`中的所有行执行Normal模式下的命令`commands`
- 将`range`设置为`%`,可以对整个文件的所有行执行
- `:[range] normal .`:配合`.`命令，效果拔群
    - 常用做法：先做一次修改操作，再用normal命令在指定的行上完成操作
- `.`命令只能记录一次修改，用宏可以实现记录多个操作
    - `:[range] normal @{register}`
    - 常用做法：先把想要做的操作录制成宏，再用normal命令在指定的行上重放宏

### global操作

- 格式:`:[range] global/{pattern}/[cmd]`
- 含义：对`range`中包含`pattern`的所有行执行command模式下的ex命令
- `[cmd]`:Ex命令，不给的话默认是打印(`print`)
- 注意,`normal`命令也是Ex命令
- `:[range] global/{pattern}/normal {command}`:对`range`中所有带`{pattern}`的行，执行Normal模式下的命令`commands`
- 例子：`:% global/TODO/delete`:删除所有带有TODO的行

### 替换命令

- `:[range]s/{pattern}/{string}/[flags]`
- 将`pattern`替换为`string`
- `flags`
    - `g`:替换每一行的所有匹配
    - `i`:忽视大小写
    - `c`:替换前进行确认
    - `n`:记数而不是替换
- `:%s/Vim//gn`:统计文件中所有`Vim`出现的次数
